"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[7624],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(n),u=r,h=p["".concat(l,".").concat(u)]||p[u]||m[u]||o;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},9805:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}const o=e=>{let{title:t,titleId:n,...o}=e;return a.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30","aria-labelledby":n},o),t?a.createElement("title",{id:n},t):null,a.createElement("defs",null,a.createElement("linearGradient",{id:"a",y2:23.625,gradientUnits:"userSpaceOnUse",x2:19.75,gradientTransform:"translate(-2 -10.871)",y1:18.5,x1:8.125},a.createElement("stop",{style:{stopColor:"#73d216"},offset:0}),a.createElement("stop",{style:{stopColor:"#5ba711"},offset:1}))),a.createElement("path",{style:{fill:"#315b09"},d:"M7.838.125a.708.708 0 0 0-.273.097l-7.21 4.12A.707.707 0 0 0 0 4.953v7.211c0 .24.12.465.322.595l6.18 4.121a.71.71 0 0 0 .74.016l7.211-4.12a.707.707 0 0 0 .354-.612v-7.21a.706.706 0 0 0-.322-.596L8.305.238a.708.708 0 0 0-.467-.113z",transform:"translate(4.609 2.99) scale(1.4035)"}),a.createElement("path",{style:{fill:"#8ae234"},d:"m1.375 9.504 12 8v14l-12-8v-14z",transform:"matrix(.63754 0 0 .63754 5.835 4.478)"}),a.createElement("path",{style:{fill:"url(#a)"},d:"m15.375 1.504 12 8-14 8-12-8 14-8z",transform:"matrix(.63754 0 0 .63754 5.835 4.478)"}),a.createElement("path",{style:{fill:"#4e9a06"},d:"M27.375 9.504v14l-14 8v-14l14-8z",transform:"matrix(.63754 0 0 .63754 5.835 4.478)"}))}},3026:(e,t,n)=>{n.d(t,{b:()=>o});var a=n(7294),r=n(9805);function o(e){e={height:"600px",width:"100%",...e};const[t,n]=(0,a.useState)(!0);return a.createElement(a.Fragment,null,t?a.createElement("div",{className:"centerLoading",style:{width:e.width,height:e.height}},a.createElement(r.Z,{style:{"max-width":"250px"},className:"center rotating"})):null,a.createElement("iframe",{hidden:t,width:e.width,height:e.height,onLoad:()=>n((e=>!e)),src:`https://replit.com/@${e.org}/${e.name}?embed=true`}),a.createElement("small",null,a.createElement("div",null,"* Live examples provided by ",a.createElement("a",{target:"_blank",href:"replit.com"},"replit"),"."),a.createElement("div",null,a.createElement("a",{target:"_blank",href:"https://replit.com/site/privacy"},"Privacy policy")," & ",a.createElement("a",{target:"_blank",href:"https://replit.com/site/privacy"},"Terms of Service"))))}},8317:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));n(3026);const o={},i="Troubleshooting",s={unversionedId:"troubleshooting",id:"troubleshooting",title:"Troubleshooting",description:"400 Cannot parse entities",source:"@site/docs/troubleshooting.mdx",sourceDirName:".",slug:"/troubleshooting",permalink:"/docs/troubleshooting",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/troubleshooting.mdx",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Filter Queries",permalink:"/docs/intro/filterQueries"},next:{title:"\ud83d\udd01 Echo bot",permalink:"/docs/live-examples/echo-bot"}},l={},c=[{value:"400: Bad Request: Cannot parse entities",id:"400-bad-request-cannot-parse-entities",level:3},{value:"400: Bad Request: message is not modified",id:"400-bad-request-message-is-not-modified",level:3},{value:"400: Bad Request: message can&#39;t be deleted for everyone",id:"400-bad-request-message-cant-be-deleted-for-everyone",level:3},{value:"400: Bad Request: message can&#39;t be edited",id:"400-bad-request-message-cant-be-edited",level:3},{value:"401: Unauthorized",id:"401-unauthorized",level:3},{value:"403: Forbidden: bot was blocked by the user",id:"403-forbidden-bot-was-blocked-by-the-user",level:3},{value:"403: Bot can&#39;t initiate conversation with a user",id:"403-bot-cant-initiate-conversation-with-a-user",level:3},{value:"404: Not found",id:"404-not-found",level:3},{value:"409: Conflict: terminated by other getUpdates request",id:"409-conflict-terminated-by-other-getupdates-request",level:3},{value:"429: Too Many Requests: retry after",id:"429-too-many-requests-retry-after",level:3},{value:"502: Bad Gateway / 500: Internal Server Error",id:"502-bad-gateway--500-internal-server-error",level:3},{value:"My bot crashes due to an error even though I use <code>bot.catch</code> handler",id:"my-bot-crashes-due-to-an-error-even-though-i-use-botcatch-handler",level:3},{value:"How can I catch completely any error in my code and handle it?",id:"how-can-i-catch-completely-any-error-in-my-code-and-handle-it",level:3},{value:"My bot working, but doesn&#39;t answer",id:"my-bot-working-but-doesnt-answer",level:3},{value:"Telegram returns number with and without &quot;+&quot; when I receive contact event",id:"telegram-returns-number-with-and-without--when-i-receive-contact-event",level:3},{value:"I can&#39;t solve my problem :(",id:"i-cant-solve-my-problem-",level:3},{value:"Something missing?",id:"something-missing",level:3}],d={toc:c};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("h1",{id:"bot-api-errors"},"Bot API Errors"),(0,r.kt)("h3",{id:"400-bad-request-cannot-parse-entities"},"400: Bad Request: Cannot parse entities"),(0,r.kt)("p",null,"This error often occurs when sending messages with invalid markup. What does it mean? You are sending a message with\n",(0,r.kt)("strong",{parentName:"p"},"Markdown"),", ",(0,r.kt)("strong",{parentName:"p"},"MarkdownV2"),", ",(0,r.kt)("strong",{parentName:"p"},"HTML")," and didn't close the tag somewhere or use reserved characters."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Markup type"),(0,r.kt)("th",{parentName:"tr",align:null},"Reserved characters"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Markdown"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"_")," ,  ",(0,r.kt)("inlineCode",{parentName:"td"},"*")," ,   ",(0,r.kt)("inlineCode",{parentName:"td"},"[")," ,  ",(0,r.kt)("inlineCode",{parentName:"td"},"\\"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"MarkdownV2"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"_")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"*")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"[")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"]")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"(")," , ",(0,r.kt)("inlineCode",{parentName:"td"},")")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"~")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"<")," , ",(0,r.kt)("inlineCode",{parentName:"td"},">")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"#")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"+")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"-")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"=")," , ",(0,r.kt)("inlineCode",{parentName:"td"},"\\"),", ",(0,r.kt)("code",null,"|"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"{")," ,  ",(0,r.kt)("inlineCode",{parentName:"td"},"}"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"."),", ",(0,r.kt)("inlineCode",{parentName:"td"},"!"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"HTML"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"&"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"<"),", ",(0,r.kt)("inlineCode",{parentName:"td"},">"))))),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Very often, many people forget to escape these special characters when inserting text received from users\nby manual input, nicknames,\nfirst name, last name and other data,\nthis can cause this error if they contain reserved characters. We recommend escaping such data with\n",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/telegram-escape"},"telegram-escape")),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},'const { Extra } = require(\'opengram\')\nconst { HTML } = require("telegram-escape");\n\n// ... bot initialization code ...\n\nconst firstName = "<My Cool Name>";\n\nbot.help(async ctx => {\n  // This throws an error\n  await ctx.replyWithHTML(`<b>${firstName}</b>`)\n})\n\nbot.start(async ctx => {\n  // This work fine, because all special chars escaped\n  await ctx.replyWithHTML(HTML`<b>${firstName}</b>`) // bold "<My Cool Name>"\n})\n'))),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you use ",(0,r.kt)("a",{parentName:"p",href:"/docs/advanced/internalization"},"i18next"),", it by default escapes HTML characters in strings in interpolation.")),(0,r.kt)("h3",{id:"400-bad-request-message-is-not-modified"},"400: Bad Request: message is not modified"),(0,r.kt)("p",null,"This error occurs when you try to update a message with data that exactly matches the data in the message.\nSolutions to this error - ignoring"),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can ignore it locally with ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise.catch")," or globally with ",(0,r.kt)("inlineCode",{parentName:"p"},"bot.catch")," handler"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},"ctx.editMessageText(`Hello, world`)\n  .catch(console.log)\n")),(0,r.kt)("p",{parentName:"admonition"},"If you look at the example, we are using ",(0,r.kt)("inlineCode",{parentName:"p"},"console.log")," because complete ignoring such as\n",(0,r.kt)("inlineCode",{parentName:"p"},".catch(Function.prototype)")," / ",(0,r.kt)("inlineCode",{parentName:"p"},".catch(() => {})"),", etc. can cause significant problems when debugging code")),(0,r.kt)("h3",{id:"400-bad-request-message-cant-be-deleted-for-everyone"},"400: Bad Request: message can't be deleted for everyone"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"deleteMessage")," method has some ",(0,r.kt)("a",{parentName:"p",href:"https://core.telegram.org/bots/api#deletemessage"},"limitations"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A message can only be deleted if it was sent less than ",(0,r.kt)("strong",{parentName:"li"},"48 hours ago"),"."),(0,r.kt)("li",{parentName:"ul"},"A dice message in a private chat can only be deleted if it was sent more than ",(0,r.kt)("strong",{parentName:"li"},"24 hours ago"),"."),(0,r.kt)("li",{parentName:"ul"},"Bots can delete outgoing messages in private chats, groups, and supergroups."),(0,r.kt)("li",{parentName:"ul"},"Bots can delete incoming messages in private chats."),(0,r.kt)("li",{parentName:"ul"},"Bots granted ",(0,r.kt)("inlineCode",{parentName:"li"},"can_post_messages")," permissions can delete outgoing messages in channels."),(0,r.kt)("li",{parentName:"ul"},"If the bot is an administrator of a group, it can delete any message there."),(0,r.kt)("li",{parentName:"ul"},"If the bot has ",(0,r.kt)("inlineCode",{parentName:"li"},"can_delete_messages")," permission in a supergroup or a channel, it can delete any message there.")),(0,r.kt)("h3",{id:"400-bad-request-message-cant-be-edited"},"400: Bad Request: message can't be edited"),(0,r.kt)("p",null,"You are most likely getting this error because the bot is trying to edit someone else's message."),(0,r.kt)("h3",{id:"401-unauthorized"},"401: Unauthorized"),(0,r.kt)("p",null,"Your bot token is wrong or revoked. Check twice is token actual in ",(0,r.kt)("a",{parentName:"p",href:"https://t.me/BotFather"},"BotFather")),(0,r.kt)("h3",{id:"403-forbidden-bot-was-blocked-by-the-user"},"403: Forbidden: bot was blocked by the user"),(0,r.kt)("p",null,"You are getting this error because the user has blocked and stopped the bot, until he unblocks it,\nyou will not be able to send messages. Solutions to this error - ignoring"),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can ignore it locally with ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise.catch")," or globally with ",(0,r.kt)("inlineCode",{parentName:"p"},"bot.catch")," handler"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},"ctx.reply(`Hello, world`)\n  .catch(console.log)\n")),(0,r.kt)("p",{parentName:"admonition"},"If you look at the example, we are using ",(0,r.kt)("inlineCode",{parentName:"p"},"console.log")," because complete ignoring such as\n",(0,r.kt)("inlineCode",{parentName:"p"},".catch(Function.prototype)")," / ",(0,r.kt)("inlineCode",{parentName:"p"},".catch(() => {})"),", etc. can cause significant problems when debugging code")),(0,r.kt)("h3",{id:"403-bot-cant-initiate-conversation-with-a-user"},"403: Bot can't initiate conversation with a user"),(0,r.kt)("p",null,"You receive this error because you try to start conversation before user start the bot (or send to bot any message).\nBots can't start conversation first, except if user send join request to chat or channel where bot added as admin\nand have access to accept / reject join requests"),(0,r.kt)("h3",{id:"404-not-found"},"404: Not found"),(0,r.kt)("p",null,"If this happens while starting your bot, then your bot token is wrong or revoked.\nCheck twice is token actual in ",(0,r.kt)("a",{parentName:"p",href:"https://t.me/BotFather"},"BotFather")),(0,r.kt)("p",null,"or maybe you try call non-exiting API method"),(0,r.kt)("h3",{id:"409-conflict-terminated-by-other-getupdates-request"},"409: Conflict: terminated by other getUpdates request"),(0,r.kt)("p",null,"You're running your bot twice on long polling. You can only run one instance of your bot."),(0,r.kt)("p",null,"If you think that you only run your bot once, you can just revoke the bot token in ",(0,r.kt)("a",{parentName:"p",href:"https://t.me/BotFather"},"BotFather"),".\nThat will stop all other instances."),(0,r.kt)("h3",{id:"429-too-many-requests-retry-after"},"429: Too Many Requests: retry after"),(0,r.kt)("p",null,"Most likely you encountered this error while trying to send messages to users.\nRead an ",(0,r.kt)("a",{parentName:"p",href:"https://core.telegram.org/bots/faq#broadcasting-to-users"},"excerpt from the official telegram documentation"),"\non the limits in mailings"),(0,r.kt)("h3",{id:"502-bad-gateway--500-internal-server-error"},"502: Bad Gateway / 500: Internal Server Error"),(0,r.kt)("p",null,"It's a problem with telegram servers, there's nothing you can do about it"),(0,r.kt)("hr",null),(0,r.kt)("h1",{id:"other"},"Other"),(0,r.kt)("h3",{id:"my-bot-crashes-due-to-an-error-even-though-i-use-botcatch-handler"},"My bot crashes due to an error even though I use ",(0,r.kt)("inlineCode",{parentName:"h3"},"bot.catch")," handler"),(0,r.kt)("p",null,"There can be two problems:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The bot crashes due to errors in external code that is not related to opengram,\nuser code or user libraries and modules"),(0,r.kt)("li",{parentName:"ul"},"The problem is incorrectly returning ",(0,r.kt)("inlineCode",{parentName:"li"},"Promise")," objects in middleware, handlers, etc. (broken promise chain)")),(0,r.kt)("p",null,"First problem not related to ",(0,r.kt)("strong",{parentName:"p"},"Opengram"),", solution depends on code."),(0,r.kt)("p",null,"But we can show how to deal with the second problem:"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Examples of wrong code \u274c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{3} showLineNumbers","{3}":!0,showLineNumbers:!0},"bot.on('message', (ctx) => {\n  // Promise not awaited and not returned\n  ctx.reply('Hello, world!')\n})\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{4} showLineNumbers","{4}":!0,showLineNumbers:!0},"bot.on('message', (ctx) => {\n  // Promise not awaited and not returned, if enter handler exists and throw an exception,\n  // it can't be handled by Opengram error handler\n  ctx.scene.enter('SCENE_NAME')\n})\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{3-4} showLineNumbers","{3-4}":!0,showLineNumbers:!0},"bot.on('message', async (ctx) => {\n  // First promise awaited, but second not\n  await ctx.reply('Hello, world!')\n  ctx.scene.enter('SCENE_NAME')\n})\n"))),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Examples of good code \u2705"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},"bot.on('message', async (ctx) => {\n  await ctx.reply('Hello, world!')\n})\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},"bot.on('message', (ctx) => {\n  await ctx.scene.enter('SCENE_NAME')\n})\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},"bot.on('message', async (ctx) => {\n  await ctx.reply('Hello, world!')\n  await ctx.scene.enter('SCENE_NAME')\n})\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},"bot.on('message', async (ctx) => {\n  await Promise.allSettled([\n    ctx.reply('Hello, world!'),\n    ctx.scene.enter('SCENE_NAME')\n  ])\n})\n"))),(0,r.kt)("h3",{id:"how-can-i-catch-completely-any-error-in-my-code-and-handle-it"},"How can I catch completely any error in my code and handle it?"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",null,"Many people ask how this can be done. It's possible."),(0,r.kt)("p",null,(0,r.kt)("b",null,"However, such processing can cause unexpected consequences, violation of the consistency of data, common state, closures in the code. Typically, this processing is used in order to exit correctly and exit with an error code for the subsequent restart of the application from scratch with a higher-standing tool, such as pm2, docker, systemctl, forever")),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},"// Handle all unhandled Promise rejections\nprocess.on('unhandledRejection', (reason, promise) => {\n  console.log(`Unhandled Rejection at Promise`, reason)\n  // ... Error processing ...\n})\n// Handle all unhandled exeptions\nprocess.on('uncaughtException', err => {\n  console.log(`Uncaught Exception thrown`, err)\n  // ... Error processing ...\n});\n")),(0,r.kt)("p",{parentName:"admonition"},"You can add it on top of your entry file to handle all unhandled rejections and exceptions. ",(0,r.kt)("strong",{parentName:"p"},"But be careful!"))),(0,r.kt)("h3",{id:"my-bot-working-but-doesnt-answer"},"My bot working, but doesn't answer"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"This problem can occur when you handle errors incorrectly, it happens that long-polling is stopped and the bot\ndoes not receive updates, however, some user code does not allow the process to complete\n(setTimeout, setInterval, other async ops), as a result, the bot doesn't answer. ",(0,r.kt)("strong",{parentName:"li"},"What can I do?")),(0,r.kt)("li",{parentName:"ul"},"Get info about current count pending updates, by calling\n",(0,r.kt)("a",{parentName:"li",href:"https://core.telegram.org/bots/api#getwebhookinfo"},"getWebhookInfo"),",\ncheck pending updates increases on new messages.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Add additional logs for catch this problem in future"),(0,r.kt)("li",{parentName:"ul"},"Try to reproduce the problem with added logs"),(0,r.kt)("li",{parentName:"ul"},"As temporary solution you can try drop all pending updates ",(0,r.kt)("b",null,"if it not contain important information"),",\nby calling ",(0,r.kt)("a",{parentName:"li",href:"https://core.telegram.org/bots/api#deletewebhook"},"deleteWebhook")))),(0,r.kt)("li",{parentName:"ul"},"Perhaps somewhere an error occurs that you simply ignore, this is also one of the varieties of the first point"),(0,r.kt)("li",{parentName:"ul"},"Double check all the places where you ignore errors, for good ",(0,r.kt)("strong",{parentName:"li"},"you should log them")),(0,r.kt)("li",{parentName:"ul"},"Telegram problems (It happened that for some reason the bot did not receive updates from telegram at all)"),(0,r.kt)("li",{parentName:"ul"},"Try to revoke and create a new token"),(0,r.kt)("li",{parentName:"ul"},"Create new bot and try with it, if it not works, and no code errors find,\necho bot example not works, maybe you can contact with ",(0,r.kt)("a",{parentName:"li",href:"https://telegram.org/support"},"telegram support "))),(0,r.kt)("h3",{id:"telegram-returns-number-with-and-without--when-i-receive-contact-event"},'Telegram returns number with and without "+" when I receive contact event'),(0,r.kt)("p",null,"This is a known Telegram side problem, you can use code like this, to solve this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},"bot.on('contact', (ctx) => {\n const { phone_number, user_id } = ctx.message.contact\n // Make number always without \"+\"\n const phoneNumber = phone_number.replace('+', '')\n //...\n})\n")),(0,r.kt)("p",null,"or globally by creating upstream middleware:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},"bot.on('contact', (ctx, next) => {\n const contact = ctx.message.contact\n // Make number always without \"+\"\n contact.phone_number = contact.phone_number.replace('+', '')\n return next()\n})\n")),(0,r.kt)("h3",{id:"i-cant-solve-my-problem-"},"I can't solve my problem :("),(0,r.kt)("admonition",{title:"Welcome to chats and discussions!",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"\ud83c\uddf7\ud83c\uddfa RU / \ud83c\uddfa\ud83c\udde6 UA chat: ",(0,r.kt)("a",{parentName:"p",href:"http://t.me/opengramjs"},"@opengramjs")),(0,r.kt)("p",{parentName:"admonition"},"\ud83c\uddfa\ud83c\uddf8 EN chat: ",(0,r.kt)("a",{parentName:"p",href:"http://t.me/opengram_en"},"@opengram_en")),(0,r.kt)("p",{parentName:"admonition"},"\ud83c\udf10 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/OpengramJS/opengram/discussions"},"GitHub Discussions"))),(0,r.kt)("h3",{id:"something-missing"},"Something missing?"),(0,r.kt)("p",null,"Check ",(0,r.kt)("a",{parentName:"p",href:"/docs/contributing"},"Contributing")," page."))}m.isMDXComponent=!0}}]);